# Copy kubeconfigs to bastion
while :; do
  echo trying to copy kubeconfig
  cat /root/.kube/config | ssh master-1 "su -l training$cluster -c 'cat >.kube/config' && exit 22"
  [ $? -eq 22 ] && break
  sleep 2
done

# Create training user and update PS1 on worker nodes
for i in $(seq 1 $nodes); do
  while :; do
    echo "PS1='\e[0;33m[\u@\h \W]\$ \e[m'" | ssh node-$cluster-$i "cat >>/etc/skel/.bashrc"
    ssh node-$cluster-$i "useradd training$cluster && passwd --stdin training$cluster <<<portworx && exit 22"
    [ $? -eq 22 ] && break
    sleep 2
  done
done

# Create Portworx specs
curl -o /home/training$cluster/training/px-operator.yml "https://install.portworx.com/$px_version?comp=pxoperator&kbver=$k8s_version&ns=portworx"
curl "https://install.portworx.com/$px_version?operator=true&mc=false&kbver=$k8s_version&ns=portworx&b=true&s=%2Fdev%2Fnvme1n1&c=px-cluster&stork=true&csi=true&mon=true&tel=true&st=k8s&promop=true" | grep -v install.portworx.com >/home/training$cluster/training/px.yml 
